# マッチングアプリ サイトマップ設計書

## 1. 基本情報
- **プロジェクト名**: prototype1（格安マッチングアプリ）
- **作成日**: 2024-01-01
- **更新日**: 2024-01-01
- **作成者**: 開発チーム
- **バージョン**: v1.0
- **対象フェーズ**: MVP → Phase2

## 2. 画面一覧

### 2.1 認証・オンボーディング系
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| A01 | スプラッシュ画面 | アプリ起動時の初期画面 | メイン | MVP |
| A02 | 初回起動画面 | アプリの説明・利用規約同意 | メイン | MVP |
| A03 | サインアップ画面 | 新規ユーザー登録 | メイン | MVP |
| A04 | ログイン画面 | 既存ユーザーログイン | メイン | MVP |
| A05 | メール認証画面 | メールアドレス確認 | メイン | MVP |
| A06 | パスワードリセット画面 | パスワード再設定 | メイン | MVP |

### 2.2 プロフィール系
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| B01 | プロフィール作成画面 | 初回プロフィール設定 | メイン | MVP |
| B02 | 自分のプロフィール画面 | 自分の情報表示・編集 | メイン | MVP |
| B03 | プロフィール編集画面 | 基本情報編集 | メイン | MVP |
| B04 | 画像管理画面 | プロフィール画像追加・編集 | メイン | MVP |
| B05 | 本人確認画面 | 身分証明書アップロード | メイン | MVP |
| B06 | 本人確認結果画面 | 審査結果表示 | メイン | MVP |

### 2.3 発見・マッチング系
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| C01 | ホーム画面（カードスタック） | スワイプでユーザー発見 | メイン | MVP |
| C02 | ユーザー詳細画面 | 他ユーザーのプロフィール詳細 | メイン | MVP |
| C03 | 検索・フィルター画面 | 条件指定でユーザー検索 | メイン | MVP |
| C04 | 検索結果一覧画面 | フィルター結果表示 | メイン | MVP |
| C05 | いいね送信完了画面 | いいね送信後の確認 | ポップアップ | MVP |
| C06 | マッチ成立画面 | マッチング成功通知 | モーダル | MVP |

### 2.4 マッチ・チャット系
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| D01 | マッチ一覧画面 | 成立したマッチの一覧 | メイン | MVP |
| D02 | チャット画面 | 1対1のメッセージ画面 | メイン | MVP |
| D03 | いいね受信一覧画面 | 受信したいいねの確認 | メイン | MVP |
| D04 | 画像送信画面 | チャット内画像送信 | モーダル | MVP |
| D05 | ビデオチャット画面 | 1対1のビデオ通話 | フルスクリーン | Phase2 |
| D06 | 通話設定画面 | ビデオチャット設定 | モーダル | Phase2 |

### 2.5 通知系
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| E01 | 通知一覧画面 | 全通知の履歴表示 | メイン | MVP |
| E02 | 通知設定画面 | 通知のON/OFF設定 | メイン | MVP |
| E03 | プッシュ通知許可画面 | 通知許可の初回設定 | モーダル | MVP |

### 2.6 設定・その他系
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| F01 | 設定画面 | アプリ全般の設定 | メイン | MVP |
| F02 | アカウント設定画面 | アカウント情報編集 | メイン | MVP |
| F03 | プライバシー設定画面 | プライバシー関連設定 | メイン | MVP |
| F04 | ヘルプ・FAQ画面 | よくある質問 | メイン | MVP |
| F05 | お問い合わせ画面 | サポートへの連絡 | メイン | MVP |
| F06 | 利用規約画面 | 規約・ポリシー表示 | メイン | MVP |
| F07 | アカウント削除画面 | 退会処理 | メイン | MVP |

### 2.7 ポイント系（Phase2）
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| G01 | ポイント残高画面 | 現在のポイント表示 | メイン | Phase2 |
| G02 | ポイント購入画面 | ポイント課金 | メイン | Phase2 |
| G03 | ポイント履歴画面 | 取引履歴表示 | メイン | Phase2 |
| G04 | 課金確認画面 | 購入前の最終確認 | モーダル | Phase2 |

### 2.8 エラー・例外系
| ID | 画面名 | 概要 | 種類 | フェーズ |
|----|--------|------|------|----------|
| H01 | ネットワークエラー画面 | 通信失敗時の表示 | モーダル | MVP |
| H02 | メンテナンス画面 | サーバーメンテナンス時 | フルスクリーン | MVP |
| H03 | 404エラー画面 | 存在しないページ | メイン | MVP |
| H04 | 権限エラー画面 | アクセス権限なし | メイン | MVP |
| H05 | 年齢確認必須画面 | 未確認ユーザーへの制限通知 | モーダル | MVP |

## 3. 画面階層構造

```
アプリルート
│
├── 認証フロー
│   ├── スプラッシュ画面 (A01)
│   ├── 初回起動画面 (A02)
│   ├── サインアップ画面 (A03)
│   ├── ログイン画面 (A04)
│   ├── メール認証画面 (A05)
│   └── パスワードリセット画面 (A06)
│
├── オンボーディング
│   ├── プロフィール作成画面 (B01)
│   ├── 画像管理画面 (B04)
│   └── 本人確認画面 (B05)
│
└── メインアプリ（タブナビゲーション）
    │
    ├── 【発見タブ】
    │   ├── ホーム画面 (C01) ★デフォルト
    │   ├── ユーザー詳細画面 (C02)
    │   ├── 検索・フィルター画面 (C03)
    │   └── 検索結果一覧画面 (C04)
    │
    ├── 【いいねタブ】
    │   └── いいね受信一覧画面 (D03)
    │
    ├── 【マッチタブ】
    │   ├── マッチ一覧画面 (D01)
    │   ├── チャット画面 (D02)
    │   └── ビデオチャット画面 (D05) [Phase2]
    │
    ├── 【ポイントタブ】[Phase2]
    │   ├── ポイント残高画面 (G01)
    │   ├── ポイント購入画面 (G02)
    │   └── ポイント履歴画面 (G03)
    │
    └── 【設定タブ】
        ├── 設定画面 (F01)
        ├── 自分のプロフィール画面 (B02)
        ├── プロフィール編集画面 (B03)
        ├── アカウント設定画面 (F02)
        ├── 通知設定画面 (E02)
        ├── ヘルプ・FAQ画面 (F04)
        └── お問い合わせ画面 (F05)
```

## 4. 主要画面遷移フロー

### 4.1 新規ユーザー登録フロー
```
A01(スプラッシュ) 
→ A02(初回起動) 
→ A03(サインアップ) 
→ A05(メール認証) 
→ B01(プロフィール作成) 
→ B04(画像管理) 
→ C01(ホーム画面)
→ [任意] B05(本人確認)
```

### 4.2 既存ユーザーログインフロー
```
A01(スプラッシュ) 
→ A04(ログイン) 
→ C01(ホーム画面)
```

### 4.3 マッチング成立フロー
```
C01(ホーム画面) 
→ C02(ユーザー詳細) 
→ いいね送信 
→ C05(送信完了) 
→ [相互いいね時] C06(マッチ成立) 
→ D02(チャット画面)
```

### 4.4 メッセージ送信フロー
```
D01(マッチ一覧) 
→ D02(チャット画面) 
→ [未確認時] H05(年齢確認必須) 
→ B05(本人確認) 
→ D02(チャット画面)
```

### 4.5 ポイント購入フロー（Phase2）
```
G01(ポイント残高) 
→ G02(ポイント購入) 
→ G04(課金確認) 
→ [App Store/Google Play] 
→ G01(残高更新)
```

## 5. 遷移条件・認証レベル

### 5.1 認証レベル定義
- **Level 0**: 未認証（ゲスト状態）
- **Level 1**: アカウント作成済み
- **Level 2**: プロフィール作成済み
- **Level 3**: 本人確認完了済み

### 5.2 画面別アクセス制御

| 認証レベル | アクセス可能画面 | 制限事項 |
|------------|------------------|----------|
| Level 0 | A01-A06 | 認証フローのみ |
| Level 1 | + B01, B04 | プロフィール作成必須 |
| Level 2 | + C01-C06, D01, D03, F01-F07 | メッセージ送信不可 |
| Level 3 | すべて | 制限なし |

### 5.3 特別な遷移条件

| 画面 | 遷移条件 | 代替動作 |
|------|----------|----------|
| D02(チャット) | 本人確認完了 | H05(確認必須)表示 |
| G01-G04 | Phase2リリース済み | 404エラー |
| D05(ビデオチャット) | 相互マッチ + Phase2 | 機能未実装エラー |
| B05(本人確認) | 書類アップロード可能 | カメラ・ギャラリー権限必要 |

## 6. ナビゲーション設計

### 6.1 タブナビゲーション（メイン）
1. **発見** (C01) - ホーム・スワイプ画面
2. **いいね** (D03) - 受信したいいね
3. **マッチ** (D01) - マッチ一覧・チャット
4. **ポイント** (G01) - [Phase2のみ] ポイント管理
5. **設定** (F01) - 各種設定・プロフィール

### 6.2 ヘッダーナビゲーション
- **検索アイコン**: C03(検索・フィルター)への遷移
- **通知アイコン**: E01(通知一覧)への遷移
- **プロフィールアイコン**: B02(自分のプロフィール)への遷移

### 6.3 戻る動作
- **システム戻るボタン**: 前画面に戻る
- **キャンセル**: モーダル・ポップアップを閉じる
- **ホームボタン**: C01(ホーム画面)に戻る

## 7. 外部連携・特殊遷移

### 7.1 カメラ・ギャラリー連携
- **B04(画像管理)**: プロフィール画像選択
- **B05(本人確認)**: 身分証明書撮影
- **D04(画像送信)**: チャット内画像送信

### 7.2 プッシュ通知からの遷移
- **いいね通知**: D03(いいね受信一覧)
- **マッチ通知**: D01(マッチ一覧)
- **メッセージ通知**: 該当のD02(チャット画面)

### 7.3 ディープリンク対応
- **ユーザー詳細**: `/user/{user_id}` → C02
- **チャット**: `/chat/{match_id}` → D02
- **設定**: `/settings` → F01

### 7.4 外部ブラウザ遷移
- **利用規約**: F06 → 外部ブラウザ
- **プライバシーポリシー**: F06 → 外部ブラウザ
- **ヘルプサイト**: F04 → 外部ブラウザ

## 8. エラーハンドリング

### 8.1 ネットワークエラー時
- **全画面共通**: H01(ネットワークエラー)モーダル表示
- **再試行ボタン**: 同画面リロード
- **オフラインモード**: キャッシュ済みデータの表示

### 8.2 権限エラー時
- **未ログイン**: A04(ログイン画面)へ強制遷移
- **未確認**: H05(年齢確認必須)モーダル表示
- **権限不足**: H04(権限エラー画面)表示

### 8.3 データなし時
- **マッチなし**: D01に空状態表示
- **メッセージなし**: D02に初回メッセージ促進
- **通知なし**: E01に空状態表示

## 9. パフォーマンス最適化

### 9.1 画面キャッシュ
- **C01(ホーム)**: ユーザーカード10件先読み
- **D01(マッチ一覧)**: 最新20件キャッシュ
- **E01(通知)**: 既読・未読状態保持

### 9.2 遅延ロード
- **画像**: スクロールに応じて段階的ロード
- **チャット履歴**: 古いメッセージは必要時取得
- **プロフィール詳細**: 表示時に詳細データ取得

## 10. 特記事項・制約

### 10.1 法的制約対応
- **年齢確認**: 18歳未満利用禁止の徹底
- **コンテンツ制限**: 不適切画像の自動検出・削除
- **利用規約**: 初回起動時の同意必須

### 10.2 技術的制約
- **同時ログイン**: 1デバイス1アカウントのみ
- **画像容量**: 1枚あたり最大10MB
- **メッセージ**: テキスト2000文字以内

### 10.3 ビジネス制約
- **MVP期間**: 基本機能のみ実装
- **Phase2**: ポイント課金機能追加
- **個人開発**: 複雑な機能は外部サービス活用

この設計により、ユーザーが迷わずに目的を達成でき、段階的な機能追加にも対応可能な構造を実現できます。